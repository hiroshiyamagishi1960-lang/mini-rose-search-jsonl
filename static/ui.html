<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ãƒŸãƒ‹ãƒãƒ©ç›†æ ½æ„›å¥½ä¼š ãƒ‡ã‚¸ã‚¿ãƒ«è³‡æ–™é¤¨</title>
  <style>
    body { font-family: "Hiragino Sans","Helvetica Neue",sans-serif; margin: 2em; }
    input { width: 80%; padding: .6em; font-size: 1rem; }
    button { padding: .6em 1.2em; margin-left: .4em; }
    #results { margin-top: 2em; }
    .item { border-bottom: 1px solid #ddd; padding: .8em 0; }
    .item a { text-decoration: none; color: #336699; }
    mark { background: #fff59d !important; font-weight: bold; }
    small { color: #666; }
  </style>
</head>
<body>
  <h1>ğŸŒ¹ ãƒŸãƒ‹ãƒãƒ©ç›†æ ½æ„›å¥½ä¼š ãƒ‡ã‚¸ã‚¿ãƒ«è³‡æ–™é¤¨</h1>
  <input id="q" placeholder="æ¤œç´¢èªã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šè‹”ãƒ»å‰ªå®šãƒ»ã‚³ãƒ³ãƒ†ã‚¹ãƒˆï¼‰" />
  <button onclick="doSearch()">æ¤œç´¢</button>
  <div id="results"></div>

  <script>
  async function doSearch(page=1) {
    const q = document.getElementById("q").value.trim();
    const res = document.getElementById("results");
    if(!q){ res.innerHTML = "æ¤œç´¢èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"; return; }
    res.innerHTML = "æ¤œç´¢ä¸­...";
    const resp = await fetch(`/api/search?q=${encodeURIComponent(q)}&page=${page}&_=${Date.now()}`, {cache:"no-store"});
    const data = await resp.json();
    if(!data.items || data.items.length===0){ res.innerHTML="è©²å½“ãªã—"; return; }

    res.innerHTML = `<p>ğŸ” ${data.total_hits} ä»¶ãƒ’ãƒƒãƒˆ (${data.page}/${Math.ceil(data.total_hits/data.page_size)})</p>`;
    data.items.forEach(r=>{
      const div=document.createElement("div");
      div.className="item";
      div.innerHTML = `
        <a href="${r.url||'#'}" target="_blank">${r.title||"(ç„¡é¡Œ)"}</a><br>
        <div>${r.content||""}</div>
      `;
      res.appendChild(div);
    });

    if(data.has_more){
      const btn=document.createElement("button");
      btn.textContent="æ¬¡ã®ãƒšãƒ¼ã‚¸ â–¶";
      btn.onclick=()=>doSearch(data.next_page);
      res.appendChild(btn);
    }
  }
  </script>
</body>
</html>
