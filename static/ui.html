<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ミニバラ盆栽愛好会 デジタル資料館</title>
  <style>
    body { font-family: "Hiragino Sans","Helvetica Neue",sans-serif; margin: 2em; }
    input { width: 80%; padding: .6em; font-size: 1rem; }
    button { padding: .6em 1.2em; margin-left: .4em; }
    #results { margin-top: 2em; }
    .item { border-bottom: 1px solid #ddd; padding: .8em 0; }
    .item a { text-decoration: none; color: #336699; }
    mark { background: #fff59d !important; font-weight: bold; }
    small { color: #666; }
  </style>
</head>
<body>
  <h1>🌹 ミニバラ盆栽愛好会 デジタル資料館</h1>
  <input id="q" placeholder="検索語を入力（例：苔・剪定・コンテスト）" />
  <button onclick="doSearch()">検索</button>
  <div id="results"></div>

  <script>
  async function doSearch(page=1) {
    const q = document.getElementById("q").value.trim();
    const res = document.getElementById("results");
    if(!q){ res.innerHTML = "検索語を入力してください。"; return; }
    res.innerHTML = "検索中...";
    const resp = await fetch(`/api/search?q=${encodeURIComponent(q)}&page=${page}&_=${Date.now()}`, {cache:"no-store"});
    const data = await resp.json();
    if(!data.items || data.items.length===0){ res.innerHTML="該当なし"; return; }

    res.innerHTML = `<p>🔍 ${data.total_hits} 件ヒット (${data.page}/${Math.ceil(data.total_hits/data.page_size)})</p>`;
    data.items.forEach(r=>{
      const div=document.createElement("div");
      div.className="item";
      div.innerHTML = `
        <a href="${r.url||'#'}" target="_blank">${r.title||"(無題)"}</a><br>
        <div>${r.content||""}</div>
      `;
      res.appendChild(div);
    });

    if(data.has_more){
      const btn=document.createElement("button");
      btn.textContent="次のページ ▶";
      btn.onclick=()=>doSearch(data.next_page);
      res.appendChild(btn);
    }
  }
  </script>
</body>
</html>
